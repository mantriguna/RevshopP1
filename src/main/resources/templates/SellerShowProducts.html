<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Seller Products</title>
    <link rel="icon" href="/Images/RevShop_1.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        /* Additional CSS for image sliding effect */
        .image-container {
            position: relative;
            height: 270px;
            overflow: hidden;
        }
        .image-container img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;  /* Ensure images cover the width of the container */
            height: 100%; /* Ensure images cover the height of the container */
            object-fit: cover; /* Maintain aspect ratio */
            transition: opacity 1s ease-in-out;
        }
        .image-container img.hidden {
            opacity: 0;
        }

        /* Fixed height for card description */
        .card-text {
            max-height: 60px; /* Set max height for description */
            overflow: hidden;  /* Hide overflow */
            text-overflow: ellipsis; /* Add ellipsis for overflow text */
            white-space: nowrap; /* Prevent text from wrapping */
        }
    </style>
</head>
<body>
    <div th:insert="~{Seller_navbar.html}"></div>
    <div class="container">
        <h1>My Products</h1>
        <hr>
        <div class="row">
            <div class="row" th:if="${productList != null}">
                <div class="col-md-4" th:each="product : ${productList}">
                    <div class="card mb-4">
                        <div class="image-container">
                            <!-- Iterate through images and only show the first one initially -->
                            <img th:if="${product.imageUrls != null and product.imageUrls.size() > 0}"
                                 th:each="image, iterStat : ${product.imageUrls}" 
                                 th:src="@{${image.imageUrl}}"
                                 th:classappend="${iterStat.index > 0} ? 'hidden' : ''"
                                 class="card-img-top" 
                                 alt="Product Image">
                        </div>
                        <div class="card-body">
                            <h5 class="card-title" th:text="${product.productName}"></h5>
                            <p class="card-text" th:text="${product.description} + '.........'"></p> <!-- Append ellipsis -->
                            <p class="card-text"><strong>Price:</strong> ₹<span th:text="${product.price}"></span></p>
                            <p class="card-text"><strong>Discount Price:</strong> ₹<span th:text="${product.price - (product.maxDiscount * product.price / 100)}"></span></p>
                            <p class="card-text"><strong>Stock-Left:</strong> <span th:text="${product.stockQuantity}"></span></p>
                            <p class="card-text"><strong>Category:</strong> <span th:text="${product.category.categoryName}"></span></p>

                            <button class="btn btn-primary" th:onclick="'updateProduct(' + ${product.productId} + ')'">Update</button>
                            <button class="btn btn-danger" th:onclick="'deleteProduct(' + ${product.productId} + ')'">Delete Product</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Script for image sliding effect on hover
        document.querySelectorAll('.image-container').forEach(function(container) {
            const images = container.querySelectorAll('img');
            let currentImageIndex = 0;

            setInterval(function() {
                images[currentImageIndex].classList.add('hidden');
                currentImageIndex = (currentImageIndex + 1) % images.length;
                images[currentImageIndex].classList.remove('hidden');
            }, 4000);
        });

        function updateProduct(productId) {
            window.location.href = '/SellerProduct/editProduct/' + productId;
        }

        function deleteProduct(productId) {
            if (confirm("Are you sure you want to delete this product?")) {
                fetch('/SellerProduct/delete/' + productId, {
                    method: 'DELETE',
                })
                .then(response => {
                    if (response.ok) {
                        alert("Product deleted successfully.");
                        // Optionally, you can refresh the page or remove the product from the list
                        location.reload(); // Reload the page
                    } else {
                        alert("Failed to delete product.");
                    }
                })
                .catch(error => {
                    console.error("Error deleting product:", error);
                    alert("An error occurred while deleting the product.");
                });
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
