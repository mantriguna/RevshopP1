<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" size="32x32" href="/Images/RevShop_1.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .product-container {
            margin: 50px auto;
            max-width: 1200px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .product-img {
            max-width: 100%;
            border-radius: 5px;
            transition: transform 0.3s ease;
        }
        .product-img:hover {
            transform: scale(1.1);
        }
        .thumbnail-list {
            display: flex;
            flex-direction: column;
        }
        .thumbnail {
            width: 60px;
            height: 60px;
            margin-bottom: 10px;
            cursor: pointer;
            border: 1px solid #ddd;
            transition: border 0.3s ease;
        }
        .thumbnail:hover {
            border: 2px solid #007bff;
        }
        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 5px;
        }
        .color-option {
            width: 30px;
            height: 30px;
            display: inline-block;
            margin-right: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 50%; /* Make the container circular */
            overflow: hidden; /* Ensures the image stays within the circle */
            transition: border-color 0.3s;
        }
        .color-option img {
            width: 100%; /* Ensures the image fills the circle */
            height: 100%;
            object-fit: cover; /* Keeps the aspect ratio and covers the container */
            border-radius: 50%; /* Makes the image circular within the container */
        }
        .color-option:hover {
            border-color: #007bff;
        }
        .color-option.selected {
            border-color: #007bff; /* Highlight selected color */
        }
        .original-price {
            text-decoration: line-through; /* Strikethrough for original price */
            color: #888; /* Gray color for original price */
            font-size: 18px;
        }
        .discount-price {
            margin-right: 10px; /* Space between price and discount percentage */
            font-size: 20px; /* Slightly larger font for discount price */
            color: #0f1111; /* Red color for discount price */
            font-weight: bold; /* Bold for emphasis */
        }
        .max-discount {
            font-size: 1em; /* Aligns with the text */
            background-color: #CC0C39; /* Red background for the label */
            color: white; /* White text color */
            padding: 5px 10px; /* Padding for better appearance */
            margin-top: 0px; /* Space above the label */
        }
        .discount-container {
            display: flex; /* Use flexbox for alignment */
            align-items: center;
        }
        /* Tooltip styles */
        .tooltip {
            position: absolute;
            background-color: #333;
            color: #fff;
            border-radius: 5px;
            padding: 5px;
            display: none;
            z-index: 100;
        }
        .wishlist-icon {
		    position: absolute !important;
		    top: 10px !important;
		    right: 10px !important;
		    cursor: pointer !important;
		    font-size: 24px !important;
		    color: white !important; /* Default color */
		    background-color: rgba(0, 0, 0, 0.1); /* Semi-transparent background to enhance visibility */
		    transition: color 0.3s, box-shadow 0.3s !important; /* Smooth transition for color and shadow */
		    border: 2px solid white; /* Circular border */
		    border-radius: 700%; /* Make it circular */
		    padding: 10px; /* Space between icon and border */
		    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* Pronounced shadow */
		}
		
		.wishlist-icon i {
		    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5); /* Shadow on icon to enhance visibility */
		}
		
		.wishlist-icon:hover {
		    color: red; /* Change color on hover */
		    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5); /* Increase shadow on hover for effect */
		}
        
        
        
        
    </style>
</head>
<body>
<div th:insert="~{Customer_navbar.html}"></div>
<div class="container product-container">
    <div class="row">

        <div class="col-md-2">
            <div class="thumbnail-list">
                <div class="thumbnail" th:each="image : ${product.imageUrls}"
                     th:attr="onclick=|changeImage('${image.imageUrl}')|">
                    <img th:src="${image.imageUrl}" alt="Product Image Thumbnail" class="img-thumbnail">
                </div>
            </div>
        </div>

        
        <div class="col-md-6 position-relative">
		    <img id="main-product-img" th:src="${product.imageUrls[0].imageUrl}" alt="Product Image" class="product-img">
		    <div class="wishlist-icon" th:attr="onclick=|toggleWishlist('${product.productId}')|">
			    
			    <i id="heart-icon" class="fa fa-heart" th:style="${isInWishlist} ? 'color: red;' : 'color: white;'"></i>
			    
			</div>
		    
		    
		</div>
        

        <div class="col-md-4">
            <h1 th:text="${product.productName}">Product Name</h1>
            <p class="original-price" th:text="'₹' + ${product.price}"></p>
            <div class="discount-container">
                <p class="discount-price" style="font-size: 3.8em !important;" th:text="'₹' + ${#numbers.formatDecimal(product.price - (product.maxDiscount * product.price / 100), 0, 0)}"></p>
                <span class="max-discount" th:text="${#numbers.formatDecimal(product.maxDiscount, 0, 0)} + '% off'">Max Discount</span>
            </div>
            <p class="product-price" th:text="'Brand: ' + ${product.brand.brandName}">Brand Name</p>

            <div class="mt-3">
			    <h5>Select Color: <span id="selectedColor"></span></h5>
			    <div class="color-options-container">
			        <div th:each="color : ${product.colors}" 
					     class="color-option" 
					     th:style="|background-color: ${color.colorUrl};|"
					     th:attr="onclick=|selectColor('${color.colorUrl}', '${color.colorName}', '${color.colorId}', '${product.productId}')|">
					    <img th:src="${color.colorUrl}" alt="Color Option" class="color-preview">
					</div>
			        <div class="tooltip" id="color-tooltip"></div>
			    </div>
	            <div class="d-flex gap-2 mt-1">
	            <button class="btn btn-warning mt-3" id="buy-button" disabled>Buy Now</button>
	            <form th:method="post" th:action="@{/cart/add}">
					<input type="hidden" id="colorNameInput" th:name="colorId">   
					<input type="hidden" name="productId" th:value="${product.productId}" id="productIdInput">         
		            <!-- Add to Cart Button in HTML -->
					<button class="btn btn-success mt-3" id="add-to-cart-button" disabled th:attr="onclick=|addToCart('${product.productId}')|">Add to Cart</button>
		            	
	            </form>
	           </div>
			</div>
            
            

            <div class="product-description mt-4">
                <h4>Product Description</h4>
                <p th:text="${product.description}">Description</p>
            </div>
        </div>

    </div>
</div>

<div class="product-reviews mt-5">
    <h4 style="margin-left:20px;">Customer Reviews</h4>

    <!-- No reviews message -->
    <div th:if="${reviewCount == 0}">
        <p style="margin-left:20px;">No reviews yet.</p>
    </div>

    <!-- Reviews summary and detailed star rating -->
    <div th:if="${reviewCount > 0}" class="d-flex justify-content-between align-items-start">

		<!-- Average rating with a large star and rating count -->
		<div class="average-rating d-flex flex-column align-items-center mb-3">
  		  <!-- Average Rating and Star -->
   		 <div class="d-flex align-items-center">
     	   <p class="average-rating-text mb-0 mr-2" 
         	  th:text="${averageRating}" style="font-size:5rem; color:black; line-height:1; margin-left:20px;">Average Rating</p>
       	 <span class="star-icon" style="font-size: 5rem; color: #FFD700; line-height:1;">★</span>
   		 </div>
    
  		  <!-- Total Ratings and Reviews Below -->
  		  <div class="total-reviews mt-2 text-center">
    		    <p th:text="'Total Ratings: ' + ${reviewCount}" style="font-size: 1.2rem; color: #666; margin: 0;"></p>
     		   <p th:text="'Total Reviews: ' + ${reviewCount}" style="font-size: 1.2rem; color: #666; margin: 0;"></p>
   			 </div>
		</div>


        <!-- Star rating bars -->
        <div class="star-rating-bars" style="flex: 1; margin-left: 40px;">
            <div class="star-rating-bar d-flex align-items-center mb-1">
                <span class="star-label" style="color: green; width: 50px;">5★</span>
                <div class="rating-bar-container mx-2" style="width:200px; height: 7px; background-color: #e0e0e0; border-radius:10px;">
                    <div th:style="'width: ' + ${starCounts[4] / reviewCount * 100} + '%; background-color: #4CAF50; height: 100%; border-radius:10px;'"></div>
                </div>
                <span th:text="${starCounts[4]}">0</span>
            </div>
            <div class="star-rating-bar d-flex align-items-center mb-1">
                <span class="star-label" style="color: lightgreen; width: 50px;">4★</span>
                <div class="rating-bar-container mx-2" style="width:200px; height: 7px; background-color: #e0e0e0; border-radius:10px;">
                    <div th:style="'width: ' + ${starCounts[3] / reviewCount * 100} + '%; background-color: #81C784; height: 100%; border-radius:10px;'"></div>
                </div>
                <span th:text="${starCounts[3]}">0</span>
            </div>
            <div class="star-rating-bar d-flex align-items-center mb-1">
                <span class="star-label" style="color: #FFD700; width: 50px;">3★</span>
                <div class="rating-bar-container mx-2" style="width:200px; height: 7px; background-color: #e0e0e0; border-radius:10px;">
                    <div th:style="'width: ' + ${starCounts[2] / reviewCount * 100} + '%; background-color: #FFEB3B; height: 100%; border-radius:10px;'"></div>
                </div>
                <span th:text="${starCounts[2]}">0</span>
            </div>
            <div class="star-rating-bar d-flex align-items-center mb-1">
                <span class="star-label" style="color: orange; width: 50px;">2★</span>
                <div class="rating-bar-container mx-2" style="width:200px; height: 7px; background-color: #e0e0e0; border-radius:10px;">
                    <div th:style="'width: ' + ${starCounts[1] / reviewCount * 100} + '%; background-color: #FF9800; height: 100%; border-radius:10px;'"></div>
                </div>
                <span th:text="${starCounts[1]}">0</span>
            </div>
            <div class="star-rating-bar d-flex align-items-center mb-1">
                <span class="star-label" style="color: red; width: 50px;">1★</span>
                <div class="rating-bar-container mx-2" style="width:200px; height: 7px; background-color: #e0e0e0; border-radius:10px;">
                    <div th:style="'width: ' + ${starCounts[0] / reviewCount * 100} + '%; background-color: #F44336; height: 100%; border-radius:10px;'"></div>
                </div>
                <span th:text="${starCounts[0]}">0</span>
            </div>
        </div>
    </div>

    <!-- Display all reviews with customer name and rating -->
    <div class="reviews-list mt-4">
        <h5 th:if="${reviewCount != 0}" style="margin-left:20px;">All Reviews:</h5>
        <div th:each="review : ${comments}">
            <div class="review-item mb-3 p-3 border rounded">
                <p><strong th:text="${review.customer.name}">Customer Name</strong> - 
                    <span th:text="${review.rating} + ' ' + '★'" style="display: inline-block; background-color: green; color: white; padding: 5px 10px; border-radius: 5px;"></span>
                </p>
                <p th:text="${review.comment}">Review Comment</p>
            </div>
        </div>
    </div>
</div>


<script>

function toggleWishlist(productId) {
    fetch(`/customerwishlist/toggle?productId=${productId}`, { method: 'POST' })
        .then(response => response.json())
        .then(isInWishlist => {
            const heartIcon = document.querySelector('#heart-icon');
            heartIcon.style.color = isInWishlist ? 'red' : 'white';
        })
        .catch(error => console.error('Error toggling wishlist:', error));
}

let selectedColorId = null;

function selectColor(colorUrl, colorName, colorId, productId) {
    selectedColorId = colorId;
    document.getElementById('selectedColor').textContent = colorName;
    document.getElementById('buy-button').disabled = false;
    checkIfInCart(productId);
}

function checkIfInCart(productId) {
    fetch(`/cart/check?productId=${productId}&colorId=${selectedColorId}`, {
        method: 'GET'
    })
        .then(isInCart => {
            const addToCartButton = document.getElementById('add-to-cart-button');
            if (isInCart.ok) {
                addToCartButton.classList.replace('btn-success', 'btn-secondary');
                addToCartButton.textContent = 'Already in Cart';
                addToCartButton.disabled = true;
            } else {
                addToCartButton.classList.replace('btn-secondary', 'btn-success');
                addToCartButton.textContent = 'Add to Cart';
                addToCartButton.disabled = false;
            }
        })
        .catch(error => console.error('Error checking cart status:', error));
}


function addToCart(productId) {

    if (!document.getElementById('add-to-cart-button').disabled) {
        fetch(`/cart/add?productId=${productId}&colorId=${selectedColorId}`, {
            method: 'POST'
        })
            .then(success => {
                if (success.status) {
                    alert("Product added to cart!");
                    window.location.reload();
                   
                    
                    
                } else {
                    alert("Failed to add product to cart. Try again.");
                }
            })
            .catch(error => console.error('Error adding to cart:', error));
    }
}

// Add mouseover and mouseout events to color options for tooltip display
document.querySelectorAll('.color-option').forEach(option => {
    option.addEventListener('mouseover', function(event) {
        const colorName = this.getAttribute('data-color-name');
        tooltip.innerText = colorName; // Show color name in the tooltip
        tooltip.style.display = 'block';
        tooltip.style.top = event.clientY + 'px'; // Position tooltip
        tooltip.style.left = event.clientX + 'px';
    });
    option.addEventListener('mouseout', function() {
        tooltip.style.display = 'none'; // Hide tooltip when not hovering
    });
});

// Close tooltip on click
document.addEventListener('click', function(event) {
    if (!event.target.classList.contains('color-option')) {
        tooltip.style.display = 'none'; // Hide tooltip if clicking outside
    }
});

function changeImage(imageUrl) {
    if (imageUrl) {
        document.getElementById('main-product-img').src = imageUrl;
    }
}

</script>

<!-- Bootstrap JS (Optional) -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>