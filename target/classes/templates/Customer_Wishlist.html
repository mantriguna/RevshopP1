<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>RevShop</title>
    <link rel="icon" type="image/png" size="32x32" href="/Images/RevShop_1.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
    body{
    background-color: white !important;
    }
        .wishlist-card {
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            display: flex;
            flex-wrap: wrap;
            max-width: 1200px;
            height: 170px;
            align-items: center;

        }
        .product-img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            margin-right: 20px;
        }
        .apple {
            flex: 1;
            padding-right: 20px;
        }
        .max-discount {
            font-size: 0.9em;
            background-color: #CC0C39;
            color: white;
            padding: 5px 10px;
        }
        .ml-auto {
            margin-left: auto;
        }
        .wishlist-btn { 
            cursor: pointer; 
        }
        .hidden {
            display: none;
        }
        @media (max-width: 768px) {
            .wishlist-card {
                flex-direction: column;
                align-items: flex-start;
            }
            .product-img {
            
                margin-right: 0;
                margin-bottom: 10px;
            }
            .ml-auto {
                margin-left: 0;
                width: 100%;
                display: flex;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div th:insert="~{Customer_navbar.html}"></div>
    <div class="container">
        <div class="row">
            <h1 class="mt-4">My Wishlist</h1>
            <hr>
            <div class="col-12">
                
                <div th:if="${wishlistItems.size() == 0}" class="text-center" style="position: relative; display: inline-block;">
				    <p style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 24px; font-weight: bold; background-color:black; border-radius:10px;">
				        &nbsp;&nbsp;Your Wishlist is empty &nbsp;&nbsp;
				    </p>
				    <video autoplay loop muted style="width: 40%; height: 50%; margin-top: 20px;">
				        <source src="https://cdnl.iconscout.com/lottie/premium/preview-watermark/empty-cart-animated-icon-download-in-lottie-json-gif-static-svg-file-formats--shopping-ecommerce-trolley-general-pack-business-icons-9949064.mp4" type="video/mp4">
				        Your browser does not support the video tag.
				    </video>
				</div>
                
                <div th:each="item : ${wishlistItems}" class="wishlist-card d-flex align-items-center">
                    <div class="product-container">
                        <a th:href="@{/customerproduct/displayproducts/{id}(id=${item.product.productId})}">
                            <div class="image-container">
                                <img th:each="image : ${item.product.imageUrls}" 
                                     th:src="${image.imageUrl}" 
                                     alt="Product Image Thumbnail" 
                                     class="img-thumbnail product-img">
                            </div>
                        </a>
                    </div>
                    
                    <div class="apple">
                        <h5 th:text="${item.product.productName}">Product Name</h5>
                        <span class="max-discount" th:text="${#numbers.formatDecimal(item.product.maxDiscount, 0, 0)} + '% off'">Max Discount</span>
                        <b><p><strong>Brand:&nbsp;</strong><span th:text="${item.product.brand.brandName}">Brand</span></p></b>
                        <p><strong>Discount Price:</strong> â‚¹<span th:text="${#numbers.formatDecimal(item.product.price - (item.product.maxDiscount * item.product.price / 100), 0, 0)}">800</span></p>
                    </div>
                    
                    <div class="ml-auto">
                        <button class="btn btn-danger wishlist-btn" th:attr="onclick=|removeFromWishlist('${item.wishlistId}')|">
                            Remove from Wishlist
                        </button>
                        <button class="btn btn-success wishlist-btn" th:attr="onclick=|moveFromWishlistToCart('${item.wishlistId}')|">Move to Cart</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Rotating images within the image container
        document.querySelectorAll('.image-container').forEach(function(container) {
            const images = container.querySelectorAll('img');
            let currentImageIndex = 0;

            // Hide all images except the first one
            images.forEach((img, index) => {
                if (index !== currentImageIndex) {
                    img.classList.add('hidden');
                }
            });

            // Function to rotate images
            setInterval(function() {
                images[currentImageIndex].classList.add('hidden');
                currentImageIndex = (currentImageIndex + 1) % images.length;
                images[currentImageIndex].classList.remove('hidden');
            }, 4000);
        });

        // Function to remove item from wishlist
        function removeFromWishlist(wishlistId) { 
            if (confirm('Are you sure you want to remove this item from your wishlist?')) {
                fetch(`/customerwishlist/remove/${wishlistId}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        location.reload(); // Reload page to show changes
                    } else {
                        alert('Failed to remove item from wishlist. Please try again.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again later.');
                });
            }
        }
        
        
        function moveFromWishlistToCart(wishlistId) {
        	
            fetch(`/customerwishlist/moveToCart/${wishlistId}`, {
                method: 'POST'
            })
            .then(response => {
                if (response.ok) {
                    location.reload(); // Reload the page to reflect the changes
                } else {
                    alert('Failed to move item to cart. Please try again.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again later.');
            });
        	
        }
    </script>
</body>
</html>
